<?xml version="1.0" encoding="utf-8"?>
<Patch>

    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>Combat Extended</li>
        </mods>

        <match Class="PatchOperationSequence">
            <operations>
                

                <!-- == Weapon == -->
                <li Class="PatchOperationAttributeSet">
                    <xpath>/Defs/ThingDef[defName="PLA_Type67StickGrenade"]</xpath>
                    <attribute>ParentName</attribute>
                    <value>BaseWeapon</value>
                </li>

                <li Class="PatchOperationRemove">
                    <xpath>Defs/ThingDef[defName="PLA_Type67StickGrenade"]/costList</xpath>
                </li>

                <li Class="PatchOperationAdd">
                    <xpath>/Defs/ThingDef[defName="PLA_Type67StickGrenade"]</xpath>
                    <value>
                        <thingClass>CombatExtended.AmmoThing</thingClass>
                        <stackLimit>75</stackLimit>
                        <resourceReadoutPriority>First</resourceReadoutPriority>
                    </value>
                </li>

                <li Class="PatchOperationSequence">
                    <success>Always</success>
                    <operations>
                        <li Class="PatchOperationTest">
                            <xpath>/Defs/ThingDef[defName="PLA_Type67StickGrenade"]/comps</xpath>
                            <success>Invert</success>
                        </li>

                        <li Class="PatchOperationAdd">
                            <xpath>/Defs/ThingDef[defName="PLA_Type67StickGrenade"]</xpath>
                            <value>
                                <comps />
                            </value>
                        </li>
                    </operations>
                </li>

                <li Class="PatchOperationAdd">
                    <xpath>/Defs/ThingDef[defName="PLA_Type67StickGrenade"]/comps</xpath>
                    <value>
                        <li Class="CombatExtended.CompProperties_ExplosiveCE">
                            <explosiveDamageType>Bomb</explosiveDamageType>
                            <explosiveRadius>3.5</explosiveRadius>
                            <explosionSound>MortarBomb_Explode</explosionSound>
                            <applyDamageToExplosionCellsNeighbors>true</applyDamageToExplosionCellsNeighbors>
                        </li>
                    </value>
                </li>

                <li Class="PatchOperationAttributeSet">
                    <xpath>/Defs/ThingDef[defName="PLA_Type67StickGrenade"]</xpath>
                    <attribute>Class</attribute>
                    <value>CombatExtended.AmmoDef</value>
                </li>

                <li Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="PLA_Type67StickGrenade"]/graphicData</xpath>
                    <value>
                        <graphicData>
                            <texPath>Things/Ammo/Type67StickGrenade</texPath>
                            <graphicClass>Graphic_StackCount</graphicClass>
                            <onGroundRandomRotateAngle>0</onGroundRandomRotateAngle>
                        </graphicData>
                    </value>
                </li>

                <li Class="CombatExtended.PatchOperationMakeGunCECompatible">
                    <defName>PLA_Type67StickGrenade</defName>
                    <statBases>
                        <MarketValue>5.05</MarketValue>
                        <Mass>0.4</Mass>
                        <Bulk>0.87</Bulk>
                        <SightsEfficiency>1</SightsEfficiency>
                        <RangedWeapon_Cooldown>1</RangedWeapon_Cooldown>
                    </statBases>
                    <Properties>
                        <label>throw stick grenade</label>
                        <verbClass>CombatExtended.Verb_ShootCEOneUse</verbClass>
                        <hasStandardCommand>true</hasStandardCommand>
                        <defaultProjectile>PLA_Proj_Type67StickGrenadeCE</defaultProjectile>
                        <range>16</range>
                        <minRange>3</minRange>
                        <warmupTime>1.6</warmupTime>
                        <soundCast>ThrowGrenade</soundCast>
                        <noiseRadius>4</noiseRadius>
                        <ai_IsBuildingDestroyer>true</ai_IsBuildingDestroyer>
                        <ignorePartialLoSBlocker>true</ignorePartialLoSBlocker>
                        <onlyManualCast>true</onlyManualCast>
                        <targetParams>
                            <canTargetLocations>true</canTargetLocations>
                        </targetParams>
                    </Properties>
                </li>

                <li Class="PatchOperationAdd">
                    <xpath>Defs</xpath>
                    <value>
                        <RecipeDef ParentName="GrenadeRecipeBase">
                            <defName>Make_PLA_Type67StickGrenade</defName>
                            <label>make type 67 stick granade x10</label>
                            <description>Craft 10 type 67 stick granade.</description>
                            <jobString>Making type 67 stick granade.</jobString>
                            <ingredients>
                                <li>
                                    <filter>
                                        <stuffCategoriesToAllow>
                                            <li>Woody</li>
                                        </stuffCategoriesToAllow>
                                    </filter>
                                    <count>20</count>
                                </li>
                                <li>
                                    <filter>
                                        <thingDefs>
                                            <li>FSX</li>
                                        </thingDefs>
                                    </filter>
                                    <count>4</count>
                                </li>
                            </ingredients>
                            <fixedIngredientFilter>
                                <stuffCategoriesToAllow>
                                    <li>Woody</li>
                                </stuffCategoriesToAllow>
                                <thingDefs>
                                    <li>FSX</li>
                                </thingDefs>
                            </fixedIngredientFilter>
                            <products>
                                <PLA_Type67StickGrenade>10</PLA_Type67StickGrenade>
                            </products>
                        </RecipeDef>
                    </value>
                </li>
            </operations>
        </match>
    </Operation>

</Patch>